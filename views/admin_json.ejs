<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Y覺ll覺k JSON Editor</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, textarea, select { width: 100%; margin-bottom: 10px; padding: 8px; }
    .student { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; }
    .add-btn { margin-top: 10px; padding: 10px; }
    #outputJson { width: 100%; height: 200px; }
  </style>
</head>
<body>

<h2>Y覺ll覺k JSON Editor</h2>

<label for="classSelect">Select Class:</label>
<select id="classSelect"></select>

<div id="studentList"></div>

<h3>Add New Student</h3>
<input id="number" placeholder="Student Number">
<input id="name" placeholder="Name">
<input id="image" placeholder="Image URL">
<input id="bio" placeholder="Bio">
<input id="department" placeholder="Department">
<textarea id="socials" placeholder='Socials (JSON format) e.g. [{"name":"Instagram","link":"..."}]'></textarea>
<button class="add-btn" onclick="addStudent()">Add Student</button>

<h3>Exported JSON</h3>
<textarea id="outputJson" readonly></textarea>
<button onclick="copyToClipboard()">Copy JSON</button>

<script>
let data = {};
const classSelect = document.getElementById("classSelect");
const studentList = document.getElementById("studentList");
const outputJson = document.getElementById("outputJson");

async function fetchData() {
  try {
    const response = await fetch("https://yillik75.com.tr/data.json");
    data = await response.json();
    populateClassSelect();
  } catch (error) {
    alert("Failed to fetch JSON data: " + error);
  }
}

function populateClassSelect() {
  const classes = data.years["2025"].classes;
  classSelect.innerHTML = "";
  for (const className in classes) {
    const option = document.createElement("option");
    option.value = className;
    option.text = className;
    classSelect.appendChild(option);
  }
  renderStudents();
}

function renderStudents() {
  const className = classSelect.value;
  const students = data.years["2025"].classes[className].students;
  studentList.innerHTML = "";
  students.forEach((student, index) => {
    const div = document.createElement("div");
    div.className = "student";
    div.innerHTML = `
      <strong>${student.name}</strong> (${student.number})<br>
      Department: ${student.department}<br>
      Bio: ${student.bio}<br>
      <small>Socials: ${JSON.stringify(student.socials)}</small>
    `;
    studentList.appendChild(div);
  });
  outputJson.value = JSON.stringify(data, null, 2);
}

function addStudent() {
  const className = classSelect.value;
  const students = data.years["2025"].classes[className].students;
  try {
    const student = {
      number: document.getElementById("number").value,
      name: document.getElementById("name").value,
      image: document.getElementById("image").value,
      bio: document.getElementById("bio").value,
      department: document.getElementById("department").value,
      socials: JSON.parse(document.getElementById("socials").value)
    };
    students.push(student);
    renderStudents();
    clearForm();
  } catch (error) {
    alert("Invalid JSON in socials field: " + error);
  }
}

function clearForm() {
  document.getElementById("number").value = "";
  document.getElementById("name").value = "";
  document.getElementById("image").value = "";
  document.getElementById("bio").value = "";
  document.getElementById("department").value = "";
  document.getElementById("socials").value = "";
}

function copyToClipboard() {
  outputJson.select();
  document.execCommand("copy");
  alert("JSON copied to clipboard!");
}

classSelect.addEventListener("change", renderStudents);

fetchData();
</script>

</body>
</html>
