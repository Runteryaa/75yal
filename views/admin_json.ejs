<!DOCTYPE html><html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Yıllık JSON Editor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      max-width: 600px;
      margin: auto;
    }
    input, textarea, select, button {
      width: 100%;
      margin-bottom: 10px;
      padding: 10px;
      box-sizing: border-box;
      font-size: 16px;
    }
    .student {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
      background: #f9f9f9;
    }
    .socials-preview {
      font-size: 14px;
      background: #eee;
      padding: 6px;
      white-space: pre-wrap;
    }
    .inline-group {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .inline-group input, .inline-group select {
      flex: 1 1 48%;
    }
    #outputJson {
      height: 200px;
    }
  </style>
</head>
<body><h2>Yıllık JSON Editor</h2><label for="yearSelect">Yıl Seçin:</label> <select id="yearSelect"></select>

<label for="classSelect">Sınıf Seçin:</label> <select id="classSelect"></select>

<div id="studentList"></div><h3>Yeni Öğrenci Ekle</h3>
<input id="number" placeholder="Öğrenci Numarası" />
<input id="name" placeholder="Ad Soyad" />
<input id="image" placeholder="Görsel URL" />
<input id="bio" placeholder="Biyografi" />
<input id="department" placeholder="Bölüm" /><h4>Sosyal Medya (Ad + Link)</h4>
<div class="inline-group">
  <input id="socialName" placeholder="Sosyal Medya Adı" />
  <input id="socialLink" placeholder="Sosyal Medya Linki" />
</div>
<button onclick="addSocial()">Sosyal Medya Ekle</button>
<div id="socialsPreview" class="socials-preview"></div><button onclick="addStudent()">Öğrenci Ekle</button>

<h3>Öğrenciye Yorum Ekle</h3>
<select id="commentTarget"></select>
<input id="commentText" placeholder="Yorum Metni" />
<input id="commentAuthor" placeholder="Yorum Yapan" /><h4>Yorum Yapanın Sosyal Medyası</h4>
<div class="inline-group">
  <select id="commentSocialSelect" onchange="handleSocialSelect()">
    <option value="">Seçiniz</option>
    <option value="Instagram">Instagram</option>
    <option value="TikTok">TikTok</option>
    <option value="YouTube">YouTube</option>
    <option value="Twitter">Twitter</option>
    <option value="GitHub">GitHub</option>
    <option value="LinkedIn">LinkedIn</option>
    <option value="ozel">Özel</option>
  </select>
  <input id="commentSocialCustom" placeholder="Özel Sosyal Medya Adı" style="display:none;" />
  <input id="commentInsta" placeholder="Kullanıcı Adı veya Link" />
</div>
<input id="commentDate" type="date" />
<button onclick="addComment()">Yorum Ekle</button><h3>Oluşturulan JSON</h3>
<textarea id="outputJson" readonly></textarea>
<button onclick="copyToClipboard()">JSON'u Kopyala</button><script>
let jsonData = {};
let socials = [];

async function loadJSON() {
  const res = await fetch('https://yillik75.com.tr/data.json');
  jsonData = await res.json();
  const years = Object.keys(jsonData.years);
  const yearSelect = document.getElementById('yearSelect');
  yearSelect.innerHTML = years.map(y => `<option value="${y}">${y}</option>`).join('');
  yearSelect.onchange = populateClasses;
  populateClasses();
}

function populateClasses() {
  const year = document.getElementById('yearSelect').value;
  const classSelect = document.getElementById('classSelect');
  const classes = Object.keys(jsonData.years[year].classes);
  classSelect.innerHTML = classes.map(c => `<option value="${c}">${c}</option>`).join('');
  populateStudents();
}

function populateStudents() {
  const year = document.getElementById('yearSelect').value;
  const className = document.getElementById('classSelect').value;
  const students = jsonData.years[year].classes[className].students || [];
  const studentList = document.getElementById('studentList');
  const commentTarget = document.getElementById('commentTarget');
  studentList.innerHTML = students.map(s => `<div class="student"><strong>${s.name}</strong> (${s.number})</div>`).join('');
  commentTarget.innerHTML = students.map((s, i) => `<option value="${i}">${s.name}</option>`).join('');
  updateOutput();
}

function addSocial() {
  const name = document.getElementById('socialName').value;
  const link = document.getElementById('socialLink').value;
  if (!name || !link) return;
  socials.push({ name, link });
  document.getElementById('socialsPreview').innerText = JSON.stringify(socials, null, 2);
  document.getElementById('socialName').value = '';
  document.getElementById('socialLink').value = '';
}

function addStudent() {
  const year = document.getElementById('yearSelect').value;
  const className = document.getElementById('classSelect').value;
  const student = {
    number: document.getElementById('number').value,
    name: document.getElementById('name').value,
    image: document.getElementById('image').value || "/placeholder.svg",
    bio: document.getElementById('bio').value,
    department: document.getElementById('department').value,
    socials: socials
  };
  jsonData.years[year].classes[className].students.push(student);
  socials = [];
  document.getElementById('socialsPreview').innerText = '';
  document.querySelectorAll('#number, #name, #image, #bio, #department').forEach(i => i.value = '');
  populateStudents();
}

function handleSocialSelect() {
  const selected = document.getElementById('commentSocialSelect').value;
  const custom = document.getElementById('commentSocialCustom');
  if (selected === 'ozel') {
    custom.style.display = 'block';
  } else {
    custom.style.display = 'none';
  }
}

function addComment() {
  const year = document.getElementById('yearSelect').value;
  const className = document.getElementById('classSelect').value;
  const students = jsonData.years[year].classes[className].students;
  const index = parseInt(document.getElementById('commentTarget').value);
  const text = document.getElementById('commentText').value;
  const author = document.getElementById('commentAuthor').value;
  let name = document.getElementById('commentSocialSelect').value;
  const custom = document.getElementById('commentSocialCustom').value;
  const linkRaw = document.getElementById('commentInsta').value;
  const date = document.getElementById('commentDate').value.split('-').reverse().join('.');

  if (name === 'ozel') name = custom;

  let link = linkRaw;
  if (name === 'Instagram' && !linkRaw.includes('http')) {
    link = `https://instagram.com/${linkRaw}`;
  }

  const comment = { text, author, insta: link, date };
  if (!students[index].comments) students[index].comments = [];
  students[index].comments.push(comment);

  document.getElementById('commentText').value = '';
  document.getElementById('commentAuthor').value = '';
  document.getElementById('commentInsta').value = '';
  document.getElementById('commentDate').value = '';
  document.getElementById('commentSocialSelect').value = '';
  document.getElementById('commentSocialCustom').value = '';
  handleSocialSelect();
  updateOutput();
}

function updateOutput() {
  document.getElementById('outputJson').value = JSON.stringify(jsonData, null, 2);
}

function copyToClipboard() {
  const output = document.getElementById('outputJson');
  output.select();
  document.execCommand('copy');
  alert('JSON kopyalandı!');
}

loadJSON();
</script></body>
</html>
